<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>{% block seo_title %}DNE{% endblock %}</title>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTNX7X8M');</script>
    <!-- End Google Tag Manager -->

    <!-- SEO мета-теги -->
    <meta name="description" content="{% block seo_description %}{% endblock %}">
    <meta name="robots" content="index, follow">

    <!-- Теги Open Graph для лучшего отображения при шаринге в социальных сетях -->
    <meta property="og:title" content="{% block og_title %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% endblock %}">
    <meta property="og:image" content="https://www.dnevent.kz/dist/images/og-image.jpg">
    <meta property="og:url" content="https://www.dnevent.kz">
    <meta property="og:type" content="website">

    <!-- Фавиконки -->
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'dist/images/favicon/favicon-16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'dist/images/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'dist/images/favicon/favicon.ico' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'dist/images/favicon/favicon-32x32.png' %}">

    <link rel="stylesheet" href="{% static 'dist/styles.css' %}">


    {% block extra_meta %}{% endblock %}

    <!-- Твои стили -->
    {% block styles %}{% endblock %}
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTNX7X8M"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <!-- Header -->
    <header class="header">
    {% block header %}
        <div class="brand">
            <a href="{% url 'contents:home' %}">
                <svg class="md:w-[4.5rem] w-[3.5rem] pt-2 md:pt-0 text-green-600" viewBox="0 0 65 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 27.7804V10.4314H7.25833V20.6431H15.3833C17.875 20.6431 22.1 19.2157 22.1 13.2863C22.1 8.54274 17.6222 7.21046 15.3833 7.13726H0V0.54902H17.4417C20.5617 0.54902 23.725 2.37909 24.9167 3.29412L40.3 15.3725V0H65L60.6667 7.24706H47.45V10.102H64.025L59.15 17.4588H47.45V20.6431H65L60.2333 28H46.9083C43.9617 28 41.275 26.7556 40.3 26.1333L28.8167 17.4588C28.4194 18.5569 27.0833 21.4557 24.9167 24.2667C22.75 27.0776 16.2139 27.9268 13.2167 28L0 27.7804Z" fill="currentColor"/>
                </svg>
            </a>
        </div>
        <nav class="navbar">
            <ul class="menu">
                <li>
                    <a href="{% url 'contents:home' %}" class="flex menu-item text-accent-500 {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                        Главная
                    </a>
                </li>
<!--                <li>-->
<!--                    <a href="{% url 'contents:home' %}#about" class="flex text-accent-500 menu-item">О нас</a>-->
<!--                </li>-->
                <li>
                    <a href="{% url 'contents:services_list' %}" class="flex text-accent-500 menu-item {% if request.resolver_match.url_name == 'services_list' or request.resolver_match.url_name == 'service_detail' %}active{% endif %}">Услуги</a>
                </li>
                <li>
                    <a href="{% url 'contents:contacts' %}" class="flex text-accent-500 menu-item {% if request.resolver_match.url_name == 'contacts' %}active{% endif %}">Контакты</a>
                </li>
            </ul>
        </nav>
        <div class="header-actions">
            <button class="btn-default hidden md:flex" data-open-form data-source="Кнопка Связаться в шапке">Связаться</button>
            <button id="burgerBtn" class="fixed top-4 right-4 z-50 p-2 md:hidden">
                <svg id="burgerIcon" height="20" viewBox="0 0 48 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0H48V3H0V0Z" fill="#000"></path>
                    <path d="M0 19H48V22H0V19Z" fill="#000"></path>
                </svg>
            </button>
        </div>
    {% endblock %}
    </header>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-black text-white">
    {% block footer %}
        <div class="py-16 px-4">
            <div>
                <a href="/" class="flex justify-center">
                    <svg class="w-[4.5rem] text-white" viewBox="0 0 65 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 27.7804V10.4314H7.25833V20.6431H15.3833C17.875 20.6431 22.1 19.2157 22.1 13.2863C22.1 8.54274 17.6222 7.21046 15.3833 7.13726H0V0.54902H17.4417C20.5617 0.54902 23.725 2.37909 24.9167 3.29412L40.3 15.3725V0H65L60.6667 7.24706H47.45V10.102H64.025L59.15 17.4588H47.45V20.6431H65L60.2333 28H46.9083C43.9617 28 41.275 26.7556 40.3 26.1333L28.8167 17.4588C28.4194 18.5569 27.0833 21.4557 24.9167 24.2667C22.75 27.0776 16.2139 27.9268 13.2167 28L0 27.7804Z" fill="currentColor"/>
                    </svg>
                </a>
            </div>

            <div class="py-12">
                <ul class="flex justify-center md:gap-16 gap-6">
                    <li class="text-gray-700 {% if request.resolver_match.url_name == 'home' %}text-white{% endif %}">
                        <a href="{% url 'contents:home' %}">Главная</a>
                    </li>
<!--                    <li class="text-gray-700">-->
<!--                        <a href="{% url 'contents:home' %}#about">О нас</a>-->
<!--                    </li>-->
                    <li class="text-gray-700 {% if request.resolver_match.url_name == 'services_list' or request.resolver_match.url_name == 'service_detail' %}text-white{% endif %}">
                        <a href="{% url 'contents:services_list' %}">Услуги</a>
                    </li>
                    <li class="text-gray-700 {% if request.resolver_match.url_name == 'contacts' %}text-white{% endif %}">
                        <a href="{% url 'contents:contacts' %}">Контакты</a>
                    </li>
                </ul>
            </div>

            <div class="w-full md:w-[80%] m-auto">
                <div class="border-y-1 border-gray-800 pb-4">
                    <p class="text-sm text-gray-700 text-center py-8">DNE — организация мероприятий в Астане и по Казахстану под ключ для корпоративных клиентов. Мы специализируемся на B2B-мероприятиях любого масштаба: новогодние корпоративы, детские утренники, тимбилдинги, брендированные подарки и корпоративный мерч. Более 10 лет опыта, креативный подход и полный цикл организации — от идеи до реализации. DNE — надёжный партнёр для вашего бизнес-праздника.</p>
                </div>
            </div>

            <div>
                <p class="text-sm text-center pt-8">ТОО “Dana Nurzhuma Events” ©2013-2025 год</p>
            </div>
        </div>
    {% endblock %}
</footer>


<!-- Модальное окно формы заявки -->
<div id="formModal" class="hidden fixed inset-0 bg-black/75 bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6 relative">
        <button id="closeFormBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-3xl">&times;</button>

        <h2 id="formModalTitle" class="text-2xl font-bold text-gray-800 mb-6">Оставьте заявку</h2>

        <form id="requestForm" class="space-y-4">
            <input type="hidden" id="formSource" name="source" value="">
            <input type="hidden" id="formPdfUrl" name="pdf_url" value="">

            <div>
                <label for="fullName" class="block text-gray-700 font-medium mb-2">ФИО</label>
                <input
                        type="text"
                        id="fullName"
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                        placeholder="Введите ФИО"
                >
            </div>

            <div>
                <label for="phone" class="block text-gray-700 font-medium mb-2">Телефон</label>
                <input
                        type="tel"
                        id="phone"
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                        placeholder="+7 (701) 234-56-78"
                >
            </div>

            <div>
                <label for="company" class="block text-gray-700 font-medium mb-2">Компания</label>
                <input
                        type="text"
                        id="company"
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                        placeholder="Название компании"
                >
            </div>

            <button
                    type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition mt-6"
            >
                Отправить заявку
            </button>
        </form>

        <div id="successMessage" class="hidden mt-4 p-4 bg-green-100 text-green-700 rounded-lg text-center">
            Заявка успешно отправлена!
        </div>
    </div>
</div>

<!-- Оверлей (затемнение фона) -->
<div id="menuOverlay" class="hidden fixed inset-0 bg-black/75 bg-opacity-50 z-40"></div>

<!-- Боковое меню -->
<div id="sideMenu" class="fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 transform translate-x-full">
    <div class="flex flex-col h-full">
        <!-- Шапка меню -->
        <div class="flex justify-between items-center p-4 border-b border-gray-200">
            <button id="closeMenuBtn" class="p-1 ml-auto hover:bg-gray-100 rounded-lg transition">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="#000" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <!-- Контент меню -->
        <nav class="flex-1 overflow-y-auto p-6">
            <ul class="space-y-3 text-gray-700">
                <li>
                    <a href="{% url 'contents:home' %}" class="{% if request.resolver_match.url_name == 'home' %}text-black{% endif %} block uppercase tracking-widest text-accent-500  hover:text-blue-600 transition">Главная</a>
                </li>
<!--                <li>-->
<!--                    <a href="#" class=" block uppercase tracking-widest text-accent-500 hover:text-blue-600 transition">О нас</a>-->
<!--                </li>-->
                <li>
                    <a href="{% url 'contents:services_list' %}" class="{% if request.resolver_match.url_name == 'services_list' or request.resolver_match.url_name == 'service_detail' %}text-black{% endif %} block uppercase tracking-widest text-accent-500 hover:text-blue-600 transition">Услуги</a>
                </li>
                <li>
                    <a href="{% url 'contents:contacts' %}" class="{% if request.resolver_match.url_name == 'contacts' %}text-black{% endif %} block uppercase tracking-widest text-accent-500 hover:text-blue-600 transition">Контакты</a>
                </li>
            </ul>

        </nav>

        <!-- Кнопка внизу меню -->
        <div class="p-6  ">
            <button id="menuFormBtn" data-open-form data-source="Меню - Оставить заявку" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition">
                Оставить заявку
            </button>
        </div>
    </div>
</div>

<script>
    // ============================================
    // МОДУЛЬ 4: БОКОВОЕ МЕНЮ
    // ============================================
    (function initSideMenu() {
        const burgerBtn = document.getElementById('burgerBtn');
        const sideMenu = document.getElementById('sideMenu');

        // Проверяем наличие необходимых элементов
        if (!burgerBtn || !sideMenu) {
            console.log('Боковое меню не найдено на странице');
            return;
        }

        const closeMenuBtn = document.getElementById('closeMenuBtn');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuFormBtn = document.getElementById('menuFormBtn');

        // Открыть меню
        function openMenu() {
            sideMenu.classList.remove('translate-x-full');
            if (menuOverlay) menuOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Закрыть меню
        function closeMenu() {
            sideMenu.classList.add('translate-x-full');
            if (menuOverlay) menuOverlay.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // События
        burgerBtn.addEventListener('click', openMenu);
        if (closeMenuBtn) closeMenuBtn.addEventListener('click', closeMenu);
        if (menuOverlay) menuOverlay.addEventListener('click', closeMenu);

        // Обработчик для кнопки "Оставить заявку" в меню
        if (menuFormBtn) {
            menuFormBtn.addEventListener('click', function() {
                const source = this.getAttribute('data-source');
                closeMenu();
                setTimeout(() => {
                    if (typeof window.openForm === 'function') {
                        window.openForm(source);
                    }
                }, 300);
            });
        }

        // Закрытие по ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !sideMenu.classList.contains('translate-x-full')) {
                closeMenu();
            }
        });

        console.log('✓ Боковое меню инициализировано');
    })();
</script>

<!-- Скрипт модального окна формы заявки -->
<script>
(function() {
    'use strict';

    const formModal = document.getElementById('formModal');

    // Проверяем наличие модального окна
    if (!formModal) {
        console.log('Модальное окно формы не найдено');
        return;
    }

    const closeFormBtn = document.getElementById('closeFormBtn');
    const requestForm = document.getElementById('requestForm');
    const successMessage = document.getElementById('successMessage');
    const formSource = document.getElementById('formSource');
    const formPdfUrl = document.getElementById('formPdfUrl');
    const formModalTitle = document.getElementById('formModalTitle');

    // Открытие модального окна
    function openFormModal(source = '', buttonText = '', pdfUrl = '') {
        if (formSource && source) {
            formSource.value = source;
        }

        if (formPdfUrl && pdfUrl) {
            formPdfUrl.value = pdfUrl;
        }

        // Обновляем заголовок
        if (formModalTitle) {
            formModalTitle.textContent = buttonText || 'Оставьте заявку';
        }

        formModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    // Закрытие модального окна
    function closeFormModal() {
        formModal.classList.add('hidden');
        document.body.style.overflow = 'auto';

        if (requestForm) requestForm.reset();
        if (successMessage) successMessage.classList.add('hidden');

        // Возвращаем заголовок по умолчанию
        if (formModalTitle) {
            formModalTitle.textContent = 'Оставьте заявку';
        }
    }

    // Закрытие по кнопке
    if (closeFormBtn) {
        closeFormBtn.addEventListener('click', closeFormModal);
    }

    // Закрытие по клику на фон
    formModal.addEventListener('click', function(e) {
        if (e.target === formModal) {
            closeFormModal();
        }
    });

    // Обработчики для всех кнопок с data-open-form
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('[data-open-form]').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();

                const source = this.getAttribute('data-source') || this.textContent;
                const buttonText = this.textContent.trim();
                const pdfUrl = this.getAttribute('data-pdf-url') || '';

                openFormModal(source, buttonText, pdfUrl);
            });
        });
    });

    // Отправка формы
    if (requestForm) {
        requestForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Отправка...';

            const formData = {
                full_name: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value,
                company: document.getElementById('company').value,
                source: formSource.value
            };

            const pdfUrl = formPdfUrl.value;

            try {
                const response = await fetch('/api/feedback/submit/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    // Показываем сообщение об успехе
                    if (successMessage) {
                        successMessage.classList.remove('hidden');
                    }
                    requestForm.reset();

                    // Если есть PDF - открываем его и закрываем модалку
                    if (pdfUrl) {
                        setTimeout(() => {
                            window.open(pdfUrl, '_blank');
                            closeFormModal();
                        }, 1500);
                    } else {
                        // Если PDF нет - просто закрываем через 2 секунды
                        setTimeout(() => {
                            closeFormModal();
                        }, 2000);
                    }
                } else {
                    alert('Ошибка: ' + (result.error || 'Неизвестная ошибка'));
                }
            } catch (error) {
                alert('Ошибка при отправке заявки. Попробуйте позже.');
                console.error('Error:', error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
    }

    console.log('✓ Модальное окно формы заявки инициализировано');
})();
</script>
</body>
</html>